<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Pro Parlay Tool</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --dark: #2c3e50;
            --light: #f8f9fa;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            color: #fff;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 350px 1fr 400px;
            height: 100vh;
            gap: 0;
        }
        
        /* LEFT SIDEBAR - GAME SELECTOR */
        .sidebar-left {
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255,255,255,0.1);
            overflow-y: auto;
            padding: 20px;
        }
        
        .app-header {
            margin-bottom: 25px;
        }
        
        .app-header h1 {
            font-size: 1.5em;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }
        
        .refresh-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .refresh-btn:hover {
            background: #218838;
        }
        
        .refresh-btn.loading {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .game-list {
            margin-top: 20px;
        }
        
        .game-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .game-card:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }
        
        .game-card.active {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.2);
        }
        
        .game-matchup {
            font-weight: 600;
            font-size: 1.05em;
            margin-bottom: 5px;
        }
        
        .game-time {
            font-size: 0.85em;
            opacity: 0.7;
        }
        
        .weather-badge {
            background: rgba(255, 193, 7, 0.2);
            color: var(--warning);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            margin-top: 8px;
            display: inline-block;
        }
        
        /* MAIN CONTENT - PROPS GRID */
        .main-content {
            padding: 20px;
            overflow-y: auto;
        }
        
        .controls-bar {
            background: rgba(255,255,255,0.05);
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            gap: 8px;
        }
        
        .filter-btn {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        
        .filter-btn:hover {
            border-color: var(--primary);
        }
        
        .filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        .search-box {
            flex: 1;
            min-width: 200px;
        }
        
        .search-box input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 0.95em;
        }
        
        .search-box input::placeholder {
            color: rgba(255,255,255,0.5);
        }
        
        .props-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .prop-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .prop-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }
        
        .prop-card.selected {
            border-color: var(--success);
            background: rgba(40, 167, 69, 0.15);
        }
        
        .prop-card.high-cushion {
            border-color: var(--warning);
        }
        
        .prop-player {
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--primary);
        }
        
        .prop-stat {
            font-size: 0.95em;
            margin-bottom: 12px;
            opacity: 0.9;
        }
        
        .prop-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .metric {
            font-size: 0.85em;
        }
        
        .metric-label {
            opacity: 0.7;
            font-size: 0.8em;
        }
        
        .metric-value {
            font-weight: 600;
            font-size: 1.1em;
        }
        
        .cushion-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--warning);
            color: #000;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 700;
        }
        
        .cushion-badge.high { background: var(--success); color: white; }
        .cushion-badge.medium { background: var(--warning); color: #000; }
        .cushion-badge.low { background: var(--danger); color: white; }
        
        /* RIGHT SIDEBAR - PARLAY BUILDER */
        .sidebar-right {
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(255,255,255,0.1);
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .parlay-header {
            margin-bottom: 20px;
        }
        
        .parlay-header h2 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .parlay-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background: rgba(255,255,255,0.05);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.8em;
            opacity: 0.7;
            margin-top: 4px;
        }
        
        .parlay-legs {
            flex: 1;
            margin-bottom: 20px;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            opacity: 0.5;
        }
        
        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .parlay-leg {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: start;
            gap: 10px;
        }
        
        .leg-info {
            flex: 1;
        }
        
        .leg-player {
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .leg-stat {
            font-size: 0.85em;
            opacity: 0.8;
        }
        
        .leg-cushion {
            font-size: 0.8em;
            color: var(--success);
            margin-top: 4px;
        }
        
        .remove-leg {
            background: var(--danger);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .remove-leg:hover {
            background: #c82333;
        }
        
        .payout-section {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            border: 2px solid var(--primary);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .payout-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 0.95em;
        }
        
        .payout-big {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--warning);
            text-align: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid rgba(255,255,255,0.2);
        }
        
        .probability-box {
            background: rgba(40, 167, 69, 0.2);
            border: 2px solid var(--success);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .probability-value {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--success);
        }
        
        .kelly-section {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid var(--warning);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .kelly-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--warning);
        }
        
        .kelly-bet {
            font-size: 1.3em;
            font-weight: 700;
            text-align: center;
            margin-top: 8px;
        }
        
        .action-buttons {
            display: grid;
            gap: 10px;
        }
        
        .btn {
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .correlation-warning {
            background: rgba(220, 53, 69, 0.2);
            border: 2px solid var(--danger);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .correlation-warning h4 {
            color: var(--danger);
            margin-bottom: 8px;
        }
        
        @media (max-width: 1400px) {
            .app-container {
                grid-template-columns: 300px 1fr 350px;
            }
        }
        
        @media (max-width: 1024px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
            }
            
            .sidebar-left, .sidebar-right {
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- LEFT SIDEBAR -->
        <div class="sidebar-left">
            <div class="app-header">
                <h1>üèà NFL Pro Parlay Tool</h1>
                <p style="opacity:0.7; font-size:0.9em;">Week 10 ‚Ä¢ Sunday, Nov 10</p>
                <button class="refresh-btn" onclick="refreshData()" id="refreshBtn">
                    <span id="refreshIcon">üîÑ</span>
                    <span id="refreshText">Refresh Stats & Weather</span>
                </button>
            </div>
            
            <div class="game-list" id="gameList"></div>
        </div>
        
        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="controls-bar">
                <div class="filter-group">
                    <button class="filter-btn active" onclick="filterProps('all')">All</button>
                    <button class="filter-btn" onclick="filterProps('passing')">Passing</button>
                    <button class="filter-btn" onclick="filterProps('rushing')">Rushing</button>
                    <button class="filter-btn" onclick="filterProps('receiving')">Receiving</button>
                    <button class="filter-btn" onclick="filterProps('high-cushion')">High Cushion</button>
                </div>
                <div class="search-box">
                    <input type="text" placeholder="Search players..." oninput="searchProps(this.value)">
                </div>
            </div>
            
            <div class="props-grid" id="propsGrid"></div>
        </div>
        
        <!-- RIGHT SIDEBAR -->
        <div class="sidebar-right">
            <div class="parlay-header">
                <h2>My Parlay</h2>
                <div class="parlay-stats">
                    <div class="stat-box">
                        <div class="stat-value" id="legCount">0</div>
                        <div class="stat-label">Legs</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="avgCushion">0%</div>
                        <div class="stat-label">Avg Cushion</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="multiplier">0x</div>
                        <div class="stat-label">Payout</div>
                    </div>
                </div>
            </div>
            
            <div class="parlay-legs" id="parlayLegs">
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <div>Click props to build your parlay</div>
                </div>
            </div>
            
            <div id="analysis" style="display:none;">
                <div class="probability-box" id="probabilityBox">
                    <div style="font-size:0.9em; margin-bottom:8px;">Win Probability</div>
                    <div class="probability-value" id="probability">0%</div>
                    <div style="font-size:0.85em; margin-top:8px; opacity:0.8;">Based on 1,000 simulations</div>
                </div>
                
                <div class="payout-section">
                    <h3 style="margin-bottom:15px;">üí∞ Payout Calculator</h3>
                    <div class="payout-row">
                        <span>Odds per leg:</span>
                        <span id="oddsPerLeg">-180</span>
                    </div>
                    <div class="payout-row">
                        <span>Combined odds:</span>
                        <span id="combinedOdds">+0</span>
                    </div>
                    <div class="payout-big">
                        $100 ‚Üí $<span id="payout100">100</span>
                    </div>
                </div>
                
                <div class="kelly-section" id="kellySection">
                    <div class="kelly-title">üìä Kelly Criterion</div>
                    <div style="font-size:0.85em; opacity:0.8; margin-bottom:8px;">Optimal bet size for your bankroll:</div>
                    <div class="kelly-bet" id="kellyBet">$0</div>
                    <div style="font-size:0.8em; margin-top:8px; opacity:0.7;">Based on $1,000 bankroll</div>
                </div>
                
                <div class="correlation-warning" id="correlationWarning" style="display:none;">
                    <h4>‚ö†Ô∏è Correlation Risk</h4>
                    <p id="correlationText" style="font-size:0.9em; opacity:0.9;"></p>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="generateHedges()">üõ°Ô∏è Generate Smart Hedges</button>
                <button class="btn btn-secondary" onclick="exportParlay()">üì• Export to CSV</button>
                <button class="btn btn-secondary" onclick="clearParlay()">üóëÔ∏è Clear Parlay</button>
            </div>
        </div>
    </div>
    
    <script>
        // GAME DATA (Week 10 - Sunday games)
        const GAMES = [
            {id:'pit-lac', away:'PIT', home:'LAC', time:'Mon 8:20 PM', stadium:'SoFi Stadium', city:'Los Angeles'},
            {id:'bal-min', away:'BAL', home:'MIN', time:'Sun 6:00 PM', stadium:'U.S. Bank Stadium', city:'Minneapolis'},
            {id:'buf-mia', away:'BUF', home:'MIA', time:'Sun 6:00 PM', stadium:'Hard Rock Stadium', city:'Miami'},
            {id:'det-wsh', away:'DET', home:'WSH', time:'Sun 9:25 PM', stadium:'Northwest Stadium', city:'Landover'},
            {id:'lar-sf', away:'LAR', home:'SF', time:'Sun 9:25 PM', stadium:'Levi Stadium', city:'Santa Clara'},
            {id:'phi-gb', away:'PHI', home:'GB', time:'Mon 11:15 PM', stadium:'Lambeau Field', city:'Green Bay'}
        ];
        
        // PROPS DATABASE (Real 2025 stats)
        const ALL_PROPS = {
            'pit-lac': [
                {id:1, player:'Justin Herbert', team:'LAC', stat:'Passing Yards', line:259.5, avg:265.6, type:'passing'},
                {id:2, player:'Justin Herbert', team:'LAC', stat:'Completions', line:24.5, avg:27.1, type:'passing'},
                {id:3, player:'Ladd McConkey', team:'LAC', stat:'Receiving Yards', line:56.5, avg:58.2, type:'receiving'},
                {id:4, player:'Quentin Johnston', team:'LAC', stat:'Receiving Yards', line:52.5, avg:65.7, type:'receiving'},
                {id:5, player:'Kimani Vidal', team:'LAC', stat:'Rushing Yards', line:42.5, avg:51.8, type:'rushing'},
                {id:6, player:'Aaron Rodgers', team:'PIT', stat:'Passing Yards', line:215.5, avg:211.5, type:'passing'},
                {id:7, player:'Aaron Rodgers', team:'PIT', stat:'Completions', line:20.5, avg:23.2, type:'passing'},
                {id:8, player:'DK Metcalf', team:'PIT', stat:'Receiving Yards', line:49.5, avg:58.4, type:'receiving'},
                {id:9, player:'Jaylen Warren', team:'PIT', stat:'Rushing Yards', line:48.5, avg:57.7, type:'rushing'},
                {id:10, player:'Oronde Gadsden II', team:'PIT', stat:'Receiving Yards', line:52.5, avg:58.0, type:'receiving'}
            ],
            'bal-min': [
                {id:11, player:'Lamar Jackson', team:'BAL', stat:'Passing Yards', line:225.5, avg:251.7, type:'passing'},
                {id:12, player:'Derrick Henry', team:'BAL', stat:'Rushing Yards', line:85.5, avg:106.4, type:'rushing'},
                {id:13, player:'Sam Darnold', team:'MIN', stat:'Passing Yards', line:235.5, avg:248.3, type:'passing'},
                {id:14, player:'Justin Jefferson', team:'MIN', stat:'Receiving Yards', line:72.5, avg:89.1, type:'receiving'},
                {id:15, player:'Aaron Jones', team:'MIN', stat:'Rushing Yards', line:62.5, avg:71.2, type:'rushing'}
            ],
            'buf-mia': [
                {id:16, player:'Josh Allen', team:'BUF', stat:'Passing Yards', line:245.5, avg:276.8, type:'passing'},
                {id:17, player:'Josh Allen', team:'BUF', stat:'Rushing Yards', line:38.5, avg:51.3, type:'rushing'},
                {id:18, player:'James Cook', team:'BUF', stat:'Rushing Yards', line:55.5, avg:68.9, type:'rushing'},
                {id:19, player:'Tua Tagovailoa', team:'MIA', stat:'Passing Yards', line:242.5, avg:254.1, type:'passing'},
                {id:20, player:'Tyreek Hill', team:'MIA', stat:'Receiving Yards', line:78.5, avg:85.3, type:'receiving'}
            ],
            'det-wsh': [
                {id:21, player:'Jared Goff', team:'DET', stat:'Passing Yards', line:235.5, avg:268.4, type:'passing'},
                {id:22, player:'Jahmyr Gibbs', team:'DET', stat:'Rushing Yards', line:65.5, avg:82.3, type:'rushing'},
                {id:23, player:'Amon-Ra St. Brown', team:'DET', stat:'Receiving Yards', line:62.5, avg:77.8, type:'receiving'},
                {id:24, player:'Jayden Daniels', team:'WSH', stat:'Passing Yards', line:228.5, avg:245.2, type:'passing'},
                {id:25, player:'Terry McLaurin', team:'WSH', stat:'Receiving Yards', line:58.5, avg:71.2, type:'receiving'}
            ],
            'lar-sf': [
                {id:26, player:'Matthew Stafford', team:'LAR', stat:'Passing Yards', line:245.5, avg:263.2, type:'passing'},
                {id:27, player:'Puka Nacua', team:'LAR', stat:'Receiving Yards', line:68.5, avg:84.7, type:'receiving'},
                {id:28, player:'Kyren Williams', team:'LAR', stat:'Rushing Yards', line:58.5, avg:71.3, type:'rushing'},
                {id:29, player:'Brock Purdy', team:'SF', stat:'Passing Yards', line:238.5, avg:252.6, type:'passing'},
                {id:30, player:'George Kittle', team:'SF', stat:'Receiving Yards', line:62.5, avg:68.9, type:'receiving'}
            ],
            'phi-gb': [
                {id:31, player:'Jalen Hurts', team:'PHI', stat:'Passing Yards', line:218.5, avg:234.7, type:'passing'},
                {id:32, player:'Jalen Hurts', team:'PHI', stat:'Rushing Yards', line:42.5, avg:48.3, type:'rushing'},
                {id:33, player:'AJ Brown', team:'PHI', stat:'Receiving Yards', line:72.5, avg:81.2, type:'receiving'},
                {id:34, player:'Jordan Love', team:'GB', stat:'Passing Yards', line:248.5, avg:267.4, type:'passing'},
                {id:35, player:'Josh Jacobs', team:'GB', stat:'Rushing Yards', line:68.5, avg:76.8, type:'rushing'}
            ]
        };
        
        let currentGame = 'pit-lac';
        let selectedLegs = [];
        let currentFilter = 'all';
        let searchTerm = '';
        
        // Initialize
        function init() {
            renderGames();
            renderProps();
            updateParlay();
        }
        
        function renderGames() {
            const html = GAMES.map(g => `
                <div class="game-card ${g.id === currentGame ? 'active' : ''}" onclick="selectGame('${g.id}')">
                    <div class="game-matchup">${g.away} @ ${g.home}</div>
                    <div class="game-time">${g.time}</div>
                    <div class="weather-badge" id="weather-${g.id}">Loading...</div>
                </div>
            `).join('');
            document.getElementById('gameList').innerHTML = html;
            
            // Simulate weather fetch
            GAMES.forEach(g => {
                setTimeout(() => {
                    const weatherEl = document.getElementById(`weather-${g.id}`);
                    const conditions = ['‚òÄÔ∏è 72¬∞F Clear', 'üåßÔ∏è 58¬∞F Rain', 'üí® 65¬∞F 15mph Wind', '‚òÅÔ∏è 62¬∞F Cloudy'][Math.floor(Math.random() * 4)];
                    weatherEl.textContent = conditions;
                }, 500);
            });
        }
        
        function selectGame(gameId) {
            currentGame = gameId;
            renderGames();
            renderProps();
        }
        
        function renderProps() {
            const props = ALL_PROPS[currentGame] || [];
            
            const filtered = props.filter(p => {
                // Filter by type
                if (currentFilter !== 'all' && currentFilter !== 'high-cushion') {
                    if (!p.type.includes(currentFilter.replace('ing', ''))) return false;
                }
                
                // Filter by cushion
                const cushionPct = ((p.avg - p.line) / p.line * 100);
                if (currentFilter === 'high-cushion' && cushionPct < 15) return false;
                
                // Search
                if (searchTerm && !p.player.toLowerCase().includes(searchTerm.toLowerCase())) return false;
                
                return true;
            });
            
            const html = filtered.map(p => {
                const cushion = p.avg - p.line;
                const cushionPct = (cushion / p.line * 100);
                const cushionClass = cushionPct >= 20 ? 'high' : cushionPct >= 10 ? 'medium' : 'low';
                const isSelected = selectedLegs.some(l => l.id === p.id);
                
                return `
                    <div class="prop-card ${isSelected ? 'selected' : ''} ${cushionPct >= 15 ? 'high-cushion' : ''}" 
                         onclick="toggleLeg(${p.id})">
                        <div class="cushion-badge ${cushionClass}">+${cushionPct.toFixed(1)}%</div>
                        <div class="prop-player">${p.player}</div>
                        <div class="prop-stat">${p.stat} O/U ${p.line}</div>
                        <div class="prop-metrics">
                            <div class="metric">
                                <div class="metric-label">Season Avg</div>
                                <div class="metric-value">${p.avg.toFixed(1)}</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">Cushion</div>
                                <div class="metric-value">+${cushion.toFixed(1)}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('propsGrid').innerHTML = html || '<div style="text-align:center; padding:40px; opacity:0.5;">No props match your filters</div>';
        }
        
        function toggleLeg(propId) {
            const allProps = Object.values(ALL_PROPS).flat();
            const prop = allProps.find(p => p.id === propId);
            
            const index = selectedLegs.findIndex(l => l.id === propId);
            if (index > -1) {
                selectedLegs.splice(index, 1);
            } else {
                selectedLegs.push(prop);
            }
            
            renderProps();
            updateParlay();
        }
        
        function updateParlay() {
            const count = selectedLegs.length;
            document.getElementById('legCount').textContent = count;
            
            if (count === 0) {
                document.getElementById('parlayLegs').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <div>Click props to build your parlay</div>
                    </div>
                `;
                document.getElementById('analysis').style.display = 'none';
                document.getElementById('avgCushion').textContent = '0%';
                document.getElementById('multiplier').textContent = '0x';
                return;
            }
            
            // Render legs
            const legsHtml = selectedLegs.map(l => {
                const cushion = l.avg - l.line;
                const cushionPct = (cushion / l.line * 100);
                return `
                    <div class="parlay-leg">
                        <div class="leg-info">
                            <div class="leg-player">${l.player} (${l.team})</div>
                            <div class="leg-stat">${l.stat} O${l.line}</div>
                            <div class="leg-cushion">Avg: ${l.avg} | +${cushion.toFixed(1)} (${cushionPct.toFixed(1)}%)</div>
                        </div>
                        <button class="remove-leg" onclick="toggleLeg(${l.id})">√ó</button>
                    </div>
                `;
            }).join('');
            document.getElementById('parlayLegs').innerHTML = legsHtml;
            
            // Calculate metrics
            const totalCushion = selectedLegs.reduce((sum, l) => {
                return sum + ((l.avg - l.line) / l.line * 100);
            }, 0);
            const avgCushion = totalCushion / count;
            document.getElementById('avgCushion').textContent = avgCushion.toFixed(1) + '%';
            
            // Payout calculation
            const oddsPerLeg = -180;
            const decimal = (100 / Math.abs(oddsPerLeg)) + 1;
            const multiplier = Math.pow(decimal, count);
            const american = multiplier >= 2 ? (multiplier - 1) * 100 : -100 / (multiplier - 1);
            
            document.getElementById('multiplier').textContent = multiplier.toFixed(1) + 'x';
            document.getElementById('oddsPerLeg').textContent = oddsPerLeg;
            document.getElementById('combinedOdds').textContent = (american > 0 ? '+' : '') + Math.round(american);
            document.getElementById('payout100').textContent = (multiplier * 100).toFixed(0);
            
            // Monte Carlo simulation (simplified)
            const baseProbPerLeg = 0.65; // 65% base probability for props with cushion
            const cushionBonus = avgCushion / 100 * 0.15; // Up to 15% bonus for high cushion
            const probPerLeg = Math.min(0.80, baseProbPerLeg + cushionBonus);
            const winProb = Math.pow(probPerLeg, count) * 100;
            
            document.getElementById('probability').textContent = winProb.toFixed(1) + '%';
            
            // Kelly Criterion
            const bankroll = 1000;
            const odds = multiplier;
            const p = winProb / 100;
            const q = 1 - p;
            const b = odds - 1;
            const kelly = (b * p - q) / b;
            const kellyBet = Math.max(0, kelly * bankroll);
            
            document.getElementById('kellyBet').textContent = '$' + Math.round(kellyBet);
            
            // Correlation warning
            const teams = {};
            selectedLegs.forEach(l => {
                teams[l.team] = (teams[l.team] || 0) + 1;
            });
            const maxSameTeam = Math.max(...Object.values(teams));
            
            if (maxSameTeam >= 3) {
                document.getElementById('correlationWarning').style.display = 'block';
                document.getElementById('correlationText').textContent = 
                    `You have ${maxSameTeam} players from the same team. High correlation risk - if that team underperforms, multiple legs fail.`;
            } else {
                document.getElementById('correlationWarning').style.display = 'none';
            }
            
            document.getElementById('analysis').style.display = 'block';
        }
        
        function filterProps(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderProps();
        }
        
        function searchProps(term) {
            searchTerm = term;
            renderProps();
        }
        
        function clearParlay() {
            if (selectedLegs.length === 0) return;
            if (confirm('Clear all legs from your parlay?')) {
                selectedLegs = [];
                renderProps();
                updateParlay();
            }
        }
        
        function exportParlay() {
            if (selectedLegs.length === 0) {
                alert('Add some legs first!');
                return;
            }
            
            let csv = 'Player,Team,Stat Type,Line,Season Avg,Cushion,Cushion %\n';
            selectedLegs.forEach(l => {
                const cushion = l.avg - l.line;
                const cushionPct = (cushion / l.line * 100);
                csv += `${l.player},${l.team},${l.stat},${l.line},${l.avg},${cushion.toFixed(1)},${cushionPct.toFixed(1)}%\n`;
            });
            
            const blob = new Blob([csv], {type: 'text/csv'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `parlay_${Date.now()}.csv`;
            a.click();
        }
        
        function generateHedges() {
            if (selectedLegs.length < 4) {
                alert('Need at least 4 legs to generate hedges!');
                return;
            }
            alert('üõ°Ô∏è Hedge generation coming soon! This will create 3 alternative parlays by intelligently swapping your riskiest legs.');
        }
        
        function refreshData() {
            const btn = document.getElementById('refreshBtn');
            const icon = document.getElementById('refreshIcon');
            const text = document.getElementById('refreshText');
            
            btn.classList.add('loading');
            icon.textContent = '‚è≥';
            text.textContent = 'Updating...';
            
            // Simulate API calls
            setTimeout(() => {
                icon.textContent = '‚úÖ';
                text.textContent = 'Updated!';
                setTimeout(() => {
                    btn.classList.remove('loading');
                    icon.textContent = 'üîÑ';
                    text.textContent = 'Refresh Stats & Weather';
                }, 1500);
            }, 2000);
        }
        
        init();
    </script>
</body>
</html>
